<!DOCTYPE html>
<!-- 
Template Name: Marvin - Responsive Bootstrap 4 Admin Dashboard Template
Author: Hencework
Contact: https://hencework.ticksy.com/

License: You must have a valid license purchased only from templatemonster to legally use the template for your project.
-->
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Mi perfil</title>
    <meta name="description" content="A responsive bootstrap 4 admin dashboard template by hencework" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Toggles CSS -->
    <link href="vendors/jquery-toggles/css/toggles.css" rel="stylesheet" type="text/css">
    <link href="vendors/jquery-toggles/css/themes/toggles-light.css" rel="stylesheet" type="text/css">

    <!-- Custom CSS -->
    <link href="dist/css/style.css" rel="stylesheet" type="text/css">
</head>

<body onload="cargar()">
    
    
	<!-- HK Wrapper -->
	<div class="hk-wrapper hk-vertical-nav">

        <!-- Top Navbar -->
        <nav class="navbar navbar-expand-xl navbar-light fixed-top hk-navbar">
            <a id="navbar_toggle_btn" class="navbar-toggle-btn nav-link-hover" href="javascript:void(0);"><span class="feather-icon"><i data-feather="menu"></i></span></a>
            <a class="navbar-brand font-weight-700" href="dashboard1.html">
                 <a href="profile.html"><img src="img/Co-Labora_logo.png" width="50" height="50"></a>
            </a>
            <ul class="navbar-nav hk-navbar-content">
                <li class="nav-item">
                    <a id="settings_toggle_btn" class="nav-link nav-link-hover" href="javascript:void(0);"><span class="feather-icon"><i data-feather="settings"></i></span></a>
                </li>
                
                <li class="nav-item dropdown dropdown-authentication">
                    <a class="nav-link dropdown-toggle no-caret" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <div class="media">
                            <div class="media-img-wrap">
                                <div class="avatar">
                                    <img src="dist/img/avatar12.jpg" id="iconoperfil" alt="user" class="avatar-img rounded-circle">
                                </div>
                                <span class="badge badge-success badge-indicator"></span>
                            </div>
                            <div class="media-body">
                                <span><span id="nombredb2"></span><i class="zmdi zmdi-chevron-down"></i></span>
                            </div>
                        </div>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" data-dropdown-in="flipInX" data-dropdown-out="flipOutX">
                        <a class="dropdown-item" href="profile.html"><i class="dropdown-icon zmdi zmdi-account"></i><span>Perfil</span></a>
                        <div class="dropdown-divider"></div>
                        <div class="sub-dropdown-menu show-on-hover">
                            <a href="#" class="dropdown-toggle dropdown-item no-caret"><i class="zmdi zmdi-check text-success"></i>En linea</a>
            
                        </div>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" style="cursor: pointer;" onclick="logout()"><i class="dropdown-icon zmdi zmdi-power"></i><span>Cerrar sesi√≥n</span></a>
                    </div>
                </li>
            </ul>
        </nav>
        <form role="search" class="navbar-search">
            <div class="position-relative">
                <a href="javascript:void(0);" class="navbar-search-icon"><span class="feather-icon"><i data-feather="search"></i></span></a>
                <input type="text" name="example-input1-group2" class="form-control" placeholder="Type here to Search">
                <a id="navbar_search_close" class="navbar-search-close" href="#"><span class="feather-icon"><i data-feather="x"></i></span></a>
            </div>
        </form>
        <!-- /Top Navbar -->

        <!-- Vertical Nav -->
        <nav class="hk-nav hk-nav-dark">
            <a href="javascript:void(0);" id="hk_nav_close" class="hk-nav-close"><span class="feather-icon"><i data-feather="x"></i></span></a>
            <div class="nicescroll-bar">
                <div class="navbar-nav-wrap">
                    <ul class="navbar-nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="profile.html" data-toggle="collapse" data-target="#dash_drp">
                                <span class="feather-icon"><i data-feather="activity"></i></span>
                                <span class="nav-link-text">Perfil</span>
                            </a>
                        </li>
                    </ul>

                    <hr class="nav-separator">
                    <div class="nav-header">
                        <span>Centros de trabajo</span>
                        <span>CT</span>
                    </div>
                    <ul class="navbar-nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="javascript:void(0);" data-toggle="collapse" data-target="#Components_drp">
                                <span class="feather-icon"><i data-feather="layout"></i></span>
                                <span class="nav-link-text">Publicos</span>
                            </a>
                            <ul id="Components_drp" class="nav flex-column collapse collapse-level-1">
                                <li class="nav-item">
                                    <ul class="nav flex-column">
                                        <li class="nav-item">
                                            <a class="nav-link" href="publicos.html">Listar</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="javascript:void(0);" data-toggle="collapse" data-target="#content_drp">
                                <span class="feather-icon"><i data-feather="type"></i></span>
                                <span class="nav-link-text">Empresariales</span>
                            </a>
                            <ul id="content_drp" class="nav flex-column collapse collapse-level-1">
                                <li class="nav-item">
                                    <ul class="nav flex-column">
                                        <li class="nav-item">
                                            <a class="nav-link" href="publicos.html">Listar</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>

                    <hr class="nav-separator">
                    <div class="nav-header">
                        <span>Mas opciones</span>
                        <span>GS</span>
                    </div>
                    <ul class="navbar-nav flex-column">
                        
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <span class="feather-icon"><i data-feather="headphones"></i></span>
                                <span class="nav-link-text">Soporte</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div id="hk_nav_backdrop" class="hk-nav-backdrop"></div>
        <!-- /Vertical Nav -->

        <!-- Setting Panel -->
        <div class="hk-settings-panel">
            <div class="nicescroll-bar position-relative">
                <div class="settings-panel-wrap">
                    <div class="settings-panel-head">
                        <a href="javascript:void(0);" id="settings_panel_close" class="settings-panel-close"><span class="feather-icon"><i data-feather="x"></i></span></a>
                    </div>
                    <hr>
                    
                    <h6 class="mb-5">Navegacion</h6>
                    <p class="font-14">Elige el menu entre blanco & negro</p>
                    <div class="button-list hk-nav-select mb-10">
                        <button type="button" id="nav_light_select" class="btn btn-outline-light btn-sm btn-wth-icon icon-wthot-bg"><span class="icon-label"><i class="fa fa-sun-o"></i> </span><span class="btn-text">Light Mode</span></button>
                        <button type="button" id="nav_dark_select" class="btn btn-outline-primary btn-sm btn-wth-icon icon-wthot-bg"><span class="icon-label"><i class="fa fa-moon-o"></i> </span><span class="btn-text">Dark Mode</span></button>
                    </div>
                    <hr>
                    <h6 class="mb-5">Navbar como tu quieras</h6>
                    <p class="font-14">Elige entre los colores</p>
                    <div class="button-list hk-navbar-select mb-10">
                        <button type="button" id="navtop_light_select" class="btn btn-outline-light btn-sm btn-wth-icon icon-wthot-bg"><span class="icon-label"><i class="fa fa-sun-o"></i> </span><span class="btn-text">Light Mode</span></button>
                        <button type="button" id="navtop_dark_select" class="btn btn-outline-primary btn-sm btn-wth-icon icon-wthot-bg"><span class="icon-label"><i class="fa fa-moon-o"></i> </span><span class="btn-text">Dark Mode</span></button>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between align-items-center">
                        <h6>Header plegable</h6>
                        <div class="toggle toggle-sm toggle-simple toggle-light toggle-bg-primary scroll-nav-switch"></div>
                    </div>
                    <button id="reset_settings" class="btn btn-primary btn-block btn-reset mt-30">Reiniciar</button>
                </div>
            </div>
            <img class="d-none" src="dist/img/logo-light.png" alt="brand" />
            <img class="d-none" src="dist/img/logo-dark.png" alt="brand" />
        </div>
        <!-- /Setting Panel -->

        <!-- Main Content -->
        <div class="hk-pg-wrapper">
			<!-- Container -->
            <div class="container-fluid">
                <!-- Row -->
                <div class="row">
                    <div class="col-xl-12 pa-0">
                        <div class="profile-cover-wrap overlay-wrap">
                            <div class="profile-cover-img" style="background-image:url('dist/img/trans-bg.jpg')"></div>
							<div class="bg-overlay bg-trans-dark-60"></div>
							<div class="container profile-cover-content py-50">
								<div class="hk-row"> 
									<div class="col-lg-6">
										<div class="media align-items-center">
											<div class="media-img-wrap  d-flex">
												<div class="avatar">
                                                    <img style="cursor: pointer;" onclick="$('#fotoperfil').click();" id="fotoperfilreal" src="dist/img/avatar12.jpg" alt="user" class="avatar-img rounded-circle">
                                                    <form id="form-foto">
                                                    <input type="file" id="fotoperfil" name="fotoperfil" style="display: none;" onchange="cambiaperfil();">
                                                    <input type="hidden" name="idenfoto" id="idenfoto">
                                                </form>
												</div>
											</div>
											<div class="media-body">
												<div class="text-white text-capitalize display-6 mb-5 font-weight-400"><span id="nombredb"></span></div>
												<div class="font-14 text-white"><span class="mr-5"><span class="font-weight-500 pr-5">Ingresado </span><span class="mr-5">Hoy</span></span></div>
											</div>
										</div>
									</div>
									<!--<div class="col-lg-6">
										<div class="button-list">
											<a href="#" class="btn btn-dark btn-wth-icon icon-wthot-bg btn-rounded"><span class="btn-text">Message</span><span class="icon-label"><i class="icon ion-md-mail"></i> </span></a>
											<a href="#" class="btn btn-icon btn-icon-circle btn-indigo btn-icon-style-2"><span class="btn-icon-wrap"><i class="fa fa-facebook"></i></span></a>
											<a href="#" class="btn btn-icon btn-icon-circle btn-sky btn-icon-style-2"><span class="btn-icon-wrap"><i class="fa fa-twitter"></i></span></a>
											<a href="#" class="btn btn-icon btn-icon-circle btn-purple btn-icon-style-2"><span class="btn-icon-wrap"><i class="fa fa-instagram"></i></span></a>
										</div>
									</div>
                                -->
								</div>
							</div>
						</div>
                        <div class="bg-white shadow-bottom">
							<div class="container">
								<ul class="nav nav-light nav-tabs" role="tablist">
									<li class="nav-item">
										<a onclick="cambio1()" style="cursor: pointer;" id="inicio" class="d-flex h-60p align-items-center nav-link active">Inicio</a>
									</li>
								</ul>
							</div>	
						</div>	

                        <!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Centro de trabajo</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" >
        <span id="desc">Descripci√≥n del centro de trabajo</span><hr style="width: 50%; margin-left: 25%">

        Habilidades requeridas
       <ul class="container" id="skills"></ul>
        <button type="button" class="btn btn-primary" id="postula" style="width: 100%">Postular ahora</button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        
      </div>
    </div>
  </div>
</div>
						
                        <div id="panel1" class="tab-content mt-sm-60 mt-30">
                            
                            <div class="tab-pane fade show active" role="tabpanel">
                                <div class="container" >
                                    
                                    <div class="hk-row" id="panel">
                                       
                                    </div>
                                    
                                </div>
                            </div>
                            
                        </div>  



					</div>
                </div>
                <!-- /Row -->
            </div>
            <!-- /Container -->

            <!-- Footer -->
            <div class="hk-footer-wrap container">
                <footer class="footer">
                    <div class="row">
                        <div class="col-md-6 col-sm-12">
                            <p>Editado por<a href="https://hencework.com/" class="text-dark" target="_blank">CETI SLAVES</a> ¬© 2020</p>
                        </div>
                        <div class="col-md-6 col-sm-12">
                            <p class="d-inline-block">Siguenos</p>
                            <a href="#" class="d-inline-block btn btn-icon btn-icon-only btn-indigo btn-icon-style-4"><span class="btn-icon-wrap"><i class="fa fa-facebook"></i></span></a>
                            <a href="#" class="d-inline-block btn btn-icon btn-icon-only btn-indigo btn-icon-style-4"><span class="btn-icon-wrap"><i class="fa fa-twitter"></i></span></a>
                            <a href="#" class="d-inline-block btn btn-icon btn-icon-only btn-indigo btn-icon-style-4"><span class="btn-icon-wrap"><i class="fa fa-google-plus"></i></span></a>
                        </div>
                    </div>
                </footer>
            </div>
            <!-- /Footer -->

        </div>
        <!-- /Main Content -->

    </div>
   <!-- /HK Wrapper -->

    <!-- jQuery -->
    <script src="vendors/jquery/dist/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="vendors/popper.js/dist/umd/popper.min.js"></script>
    <script src="vendors/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Slimscroll JavaScript -->
    <script src="dist/js/jquery.slimscroll.js"></script>

    <!-- Fancy Dropdown JS -->
    <script src="dist/js/dropdown-bootstrap-extended.js"></script>

    <!-- FeatherIcons JavaScript -->
    <script src="dist/js/feather.min.js"></script>
	
	<!-- twitter JavaScript -->
    <script src="dist/js/twitterFetcher.js"></script>
    <script src="dist/js/widgets-data.js"></script>
	
	<!-- Owl JavaScript -->
    <script src="vendors/owl.carousel/dist/owl.carousel.min.js"></script>

    <!-- Owl Init JavaScript -->
    <script src="dist/js/owl-data.js"></script>
	
    <!-- Toggles JavaScript -->
    <script src="vendors/jquery-toggles/toggles.min.js"></script>
    <script src="dist/js/toggle-data.js"></script>

    <!-- Init JavaScript -->
    <script src="dist/js/init.js"></script>

</body>

</html>


<script type="text/javascript">
    var User;
    var email;
   function  cargar(){
        if (localStorage.getItem("email") === null) {
        location.href='index.html';
        }else{

            email= localStorage.getItem("email");
            var pass= localStorage.getItem("pass");
            $.ajax({
                            type: 'POST',
                            url:  'php/toma-user.php',
                            data: 'email=' +email + '&pass=' +pass,
                            success     : function(response) {
                                if (response == "error") {
                                    localStorage.clear();
                                    location.href='index.html';
                                } else {
                                    User=JSON.parse(response);
                                    console.log(User);

                                    if (User.estado!='pendiente') {
                                        location.href='profile.html';
                                    }


                                    if (response!=null) {
                                        $("#nombredb").text(User.nombre+" "+User.apellido_p+" "+ User.apellido_m);
                                        $("#nombredb2").text(User.nombre);
                                        $("#direccion").text('CP: '+User.cp+", "+User.direccion+" "+User.numero_ext+" interior "+ User.numero_int);
                                        document.getElementById('idenfoto').value=User.id;
                                        $('#fotoperfilreal').attr('src','perfiles/'+User.fotoperfil);
                                        $('#iconoperfil').attr('src','perfiles/'+User.fotoperfil);
                                    }

                                    /* QUITAR COMENTARIOS
                                    if (User.estado!='pendiente') {
                                        location.href="profile.html";
                                    }
                                    */


                                     $.ajax({
                            type: 'POST',
                            url:  'php/listauser-centros.php',
                            data: 'id=' +User.id , //AQUI SE DEBE ENVIAR LATITUD Y LONGITUD
                            success     : function(response) {
                                if (response == "error") {
                                    $("#panel1").text("No hay centros de trabajo por tu zona todavia");
                                } else {

                                    

                                    Centros=JSON.parse(response);
                                    console.log(Centros);
                                    var i;
                                    var panel=document.getElementById('panel');

                                    for(i=0; i<Centros.centros.length; i++){

                                        console.log(User.latitud);
                                        console.log(User.longitud);
                                        console.log(Centros.centros[i].latitud);
                                        console.log(Centros.centros[i].longitud);
                                        var km=getKilometros(User.latitud,User.longitud,Centros.centros[i].latitud,Centros.centros[i].longitud);
                                        console.log(km);

                                        if (km<5) {

                                        var newDiv = document.createElement("div");
                                       newDiv.className = "col-lg-12 card";
                                       var newDiv2 = document.createElement("div");
                                       newDiv2.className = "container";
                                       var img = document.createElement('img');
                                        img.src =  'http://proyectosinformaticatnl.ceti.mx/pestenegra/dashboard/centros/'+Centros.centros[i].imagen; 
                                        img.setAttribute("style", "width:80%; height:80%;margin-left:10%;");
                                       img.className = "card-img-top";
                                       var body = document.createElement('div');
                                       body.className = "card-body";
                                       var title = document.createElement('h5');
                                       title.className = "card-title";
                                       title.setAttribute("style", "margin-left:5%;");
                                       var text = document.createElement('p');
                                       text.className = "card-text";
                                       text.setAttribute("style", "margin-left:5%;");
                                       var hr = document.createElement('hr');
                                       hr.setAttribute("style", "width:90%;margin-left:5%;");
                                       var br = document.createElement('br');


                                        var span = document.createElement("SPAN");
                                        if (Centros.centros[i].estado=="pendiente") {
                                            var disponible = document.createTextNode("Pendiente");
                                            span.setAttribute("style", "position: absolute;right: 7%;top: 0%; padding:1%; color:white; background:orange"); 
                                        }
                                        if (Centros.centros[i].estado=="disponible") {
                                            var disponible = document.createTextNode("Disponible");
                                            span.setAttribute("style", "position: absolute;right: 7%;top: 0%; padding:1%; color:white; background:green"); 
                                        }
                                        if (Centros.centros[i].estado=="completo") {
                                            var disponible = document.createTextNode("Completo");
                                            span.setAttribute("style", "position: absolute;right: 7%;top: 0%; padding:1%; color:white; background:purple"); 
                                        }
                                        if (Centros.centros[i].estado=="rechazado") {
                                            var disponible = document.createTextNode("Rechazado");
                                            span.setAttribute("style", "position: absolute;right: 7%;top: 0%; padding:1%; color:white; background:red"); 
                                        }
                                        
                                        span.appendChild(disponible);


                                        var titulo = document.createTextNode(Centros.centros[i].nombre); 
                                        var texto = document.createTextNode(Centros.centros[i].descripcion); 
            if (Centros.centros[i].numero_int!=null) {
             var texto2 = document.createTextNode(Centros.centros[i].direccion+" "+ Centros.centros[i].numero_ext+" "+Centros.centros[i].numero_int); 
            }else{
                var texto2 = document.createTextNode(Centros.centros[i].direccion+" "+ Centros.centros[i].numero_ext);
            }
                                        title.appendChild(titulo);  
                                        text.appendChild(texto);  
                                        text.appendChild(br);  
                                        text.appendChild(texto2); 

                                        
                                        body.appendChild(title); 
                                        body.appendChild(hr); 
                                        body.appendChild(img); 
                                        body.appendChild(text); 

                                        newDiv2.appendChild(body);
                                        newDiv.appendChild(span); 
                                        newDiv.appendChild(newDiv2); 
                                        newDiv.setAttribute("style", "position: relative; cursor:pointer;");
                                        $(newDiv).attr("data-toggle", "modal");
                                        $(newDiv).attr("data-target", "#exampleModal");
                                        $(newDiv).attr("onclick", "cambiamodal("+Centros.centros[i].id+")");

                                        
                                        
                                        panel.appendChild(newDiv);
                                        }
                                    }
                                     
                                }
                            }

                        });
                                }
                            }
                        });
        }

    }
    function cambiamodal(idcentro) {
        $("#skills").text("");
        $.ajax({
                            type: 'POST',
                            url:  'php/ver-centro.php',
                            data: 'id=' +idcentro,
                            success     : function(response) {
                               
                               Centros=JSON.parse(response);
                               console.log(Centros);
                               $("#exampleModalLabel").text(Centros.centros[0].nombre);
                               $("#desc").text(Centros.centros[0].descripcion);
                               var skillsul=document.getElementById('skills');

                               var cont=0;
                                var skillsparseadas=JSON.parse(Centros.centros[0].skills);
                                var skillsuser=Object.keys(skillsparseadas);
                                cont=skillsuser.length;

                               for (var i = 1; i <=cont ; i++) {
                                   var li = document.createElement('li');
                                   $(li).text(skillsparseadas[i-1]);
                                   $(li).attr("type","disc");
                                   skillsul.appendChild(li);
                               }
                               




                               $("#postula").attr("onclick", "postulacion("+Centros.centros[0].id+","+Centros.centros[0].id_empresa+")");
                            }
                        });
    }

    function postulacion(idcentro,idempresa) {
        $.ajax({
                            type: 'POST',
                            url:  'php/postulacion-user.php',
                            data: 'idcentro=' +idcentro+ '&idempresa=' +idempresa+ '&id=' +User.id,
                            success     : function(response) {
                               
                               location.href="profile.html";
                            }
                        });
    }

    function logout() {
        localStorage.clear();
        location.href='index.html';
    }

    function cambio1(argument) {
        document.getElementById('inicio').className ="d-flex h-60p align-items-center nav-link active";
        document.getElementById('datos').className ="d-flex h-60p align-items-center nav-link";
        document.getElementById('panel1').style.display ="block";   
    }
    function cambio2(argument) {
        document.getElementById('datos').className ="d-flex h-60p align-items-center nav-link active";
        document.getElementById('inicio').className ="d-flex h-60p align-items-center nav-link";
        document.getElementById('panel1').style.display ="none";
       
    }
    function cambiaperfil() {
        console.log("intento");
        var form=document.getElementById('form-foto');
        $.ajax({
                            type: 'POST',
                            url:  'php/subeperfil.php',
                            data: new FormData(form),
                            contentType: false,
                            processData: false,
                            success     : function(response) {
                             //  $('#formavatar')[0].reset();
                              $('#fotoperfilreal').attr('src','perfiles/'+response);
                              $('#iconoperfil').attr('src','perfiles/'+response);
                            }
                        });
        
    }

 function getKilometros(lat1,lon1,lat2,lon2)
 {
 rad = function (x) {
         return x * Math.PI / 180;
     }
var R = 6378.137;//Radio de la tierra en km
     var dLat = rad(lat2 - lat1);
     var dLong = rad(lon2 - lon1);
     var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(rad(lat1)) * Math.cos(rad(lat2)) * Math.sin(dLong / 2) * Math.sin(dLong / 2);
     var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
     var d = R * c;
     return d.toFixed(3);//Retorna tres decimales
 }
 

</script>